<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎßàÏù¥ÌéòÏù¥ÏßÄ - Memory Treasures</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="bg-light">
    <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand" th:href="@{/}">üè™ Memory Treasures</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" th:href="@{/}">Ìôà</a>
                <a class="nav-link" th:href="@{/products}">ÏÉÅÌíà</a>
                <a class="nav-link" th:href="@{/cart}">Ïû•Î∞îÍµ¨Îãà</a>
                <span class="navbar-text me-3" sec:authentication="name"></span>
                <form th:action="@{/logout}" method="post" class="d-inline">
                    <button type="submit" class="btn btn-outline-light btn-sm">Î°úÍ∑∏ÏïÑÏõÉ</button>
                </form>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
            <div class="col-md-3">
                <div class="card shadow-sm">
                    <div class="card-body text-center">
                        <!-- ÌîÑÎ°úÌïÑ Ï†ïÎ≥¥ -->
                        <div class="mb-3">
                            <div class="avatar-circle bg-primary text-white d-inline-flex align-items-center justify-content-center"
                                 style="width: 80px; height: 80px; border-radius: 50%; font-size: 2rem;" 
                                 th:text="${user.characterType.avatar}">üê±</div>
                        </div>
                        <h5 th:text="${user.nickname}">ÏÇ¨Ïö©ÏûêÎ™Ö</h5>
                        <p class="text-muted small" th:text="${user.characterType.description}">Ï∫êÎ¶≠ÌÑ∞ ÏÑ§Î™Ö</p>
                        <span class="badge bg-success">Î†àÎ≤® 5</span>
                    </div>
                </div>

                <!-- ÌÜµÍ≥Ñ -->
                <div class="card shadow-sm mt-3">
                    <div class="card-body">
                        <h6 class="card-title">üìä ÎÇòÏùò ÌÜµÍ≥Ñ</h6>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Íµ¨Îß§ Í∏∞Ïñµ:</span>
                            <strong th:text="${userStats.totalPurchases} + 'Í∞ú'">12Í∞ú</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Ï†ÅÎ¶Ω Ìè¨Ïù∏Ìä∏:</span>
                            <strong th:text="${userStats.totalPoints} + 'P'">2,450P</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Í∞ÄÏûÖÏùº:</span>
                            <strong th:text="${#temporals.format(user.createdAt, 'yyyy.MM.dd')}">2025.09.01</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
            <div class="col-md-9">
                <!-- ÌîÑÎ°úÌïÑ ÏàòÏ†ï -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">üë§ ÌîÑÎ°úÌïÑ Ï†ïÎ≥¥</h5>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/profile/update}" th:object="${userUpdateDTO}" method="post">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">ÏïÑÏù¥Îîî</label>
                                        <input type="text" class="form-control" th:value="${user.username}" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="nickname" class="form-label">ÎãâÎÑ§ÏûÑ</label>
                                        <input type="text" class="form-control" th:field="*{nickname}" id="nickname">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="email" class="form-label">Ïù¥Î©îÏùº</label>
                                        <input type="email" class="form-control" th:field="*{email}" id="email">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Ï∫êÎ¶≠ÌÑ∞</label>
                                        <input type="text" class="form-control" th:value="${user.characterType.displayName}" readonly>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Ï†ïÎ≥¥ ÏàòÏ†ï</button>
                        </form>
                    </div>
                </div>

                <!-- Ï£ºÎ¨∏ ÎÇ¥Ïó≠ -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">üì¶ ÏµúÍ∑º Ï£ºÎ¨∏ ÎÇ¥Ïó≠</h5>
                    </div>
                    <div class="card-body">
                        <div th:if="${#lists.isEmpty(recentOrders)}" class="text-center text-muted py-4">
                            <p>ÏïÑÏßÅ Ï£ºÎ¨∏Ìïú Í∏∞ÏñµÏù¥ ÏóÜÏñ¥Ïöî!</p>
                            <a th:href="@{/products}" class="btn btn-primary">Í∏∞Ïñµ Íµ¨Í≤ΩÌïòÎü¨ Í∞ÄÍ∏∞</a>
                        </div>
                        
                        <div th:each="order : ${recentOrders}" class="border-bottom pb-3 mb-3">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>Ï£ºÎ¨∏Î≤àÌò∏:</strong> <span th:text="${order.orderNumber}">MT001</span><br>
                                    <strong>Ï£ºÎ¨∏Ïùº:</strong> <span th:text="${#temporals.format(order.createdAt, 'yyyy-MM-dd HH:mm')}">2025-09-20 14:30</span>
                                </div>
                                <div class="text-end">
                                    <span class="badge" 
                                          th:classappend="${order.status.name() == 'COMPLETED'} ? 'bg-success' : 
                                                         (${order.status.name() == 'SHIPPING'} ? 'bg-warning' : 'bg-secondary')"
                                          th:text="${order.status.description}">Î∞∞ÏÜ°ÏôÑÎ£å</span><br>
                                    <strong th:text="${#numbers.formatInteger(order.totalAmount, 0, 'COMMA')} + 'Ïõê'">45,000Ïõê</strong>
                                </div>
                            </div>
                            <div class="mt-2">
                                <div th:each="item : ${order.orderItems}" class="small text-muted">
                                    ‚Ä¢ <span th:text="${item.productName}">ÏÉÅÌíàÎ™Ö</span> 
                                    (<span th:text="${item.quantity}">1</span>Í∞ú)
                                </div>
                            </div>
                        </div>
                        
                        <div th:if="${!#lists.isEmpty(recentOrders)}" class="text-center">
                            <a th:href="@{/profile/orders}" class="btn btn-outline-primary">Ï†ÑÏ≤¥ Ï£ºÎ¨∏ Î≥¥Í∏∞</a>
                        </div>
                    </div>
                </div>

                <!-- Ìè¨Ïù∏Ìä∏ ÎÇ¥Ïó≠ -->
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">üí∞ Ìè¨Ïù∏Ìä∏ ÎÇ¥Ïó≠</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span>ÌòÑÏû¨ Î≥¥Ïú† Ìè¨Ïù∏Ìä∏</span>
                            <h4 class="text-primary" th:text="${userStats.totalPoints} + 'P'">2,450P</h4>
                        </div>
                        
                        <div th:each="point : ${recentPointHistory}" class="d-flex justify-content-between py-2">
                            <div>
                                <span th:text="${point.description}">Íµ¨Îß§ Ï†ÅÎ¶Ω</span><br>
                                <small class="text-muted" th:text="${#temporals.format(point.createdAt, 'MM-dd HH:mm')}">09-20 14:30</small>
                            </div>
                            <span class="fw-bold" 
                                  th:classappend="${point.amount > 0} ? 'text-success' : 'text-danger'"
                                  th:text="${point.amount > 0 ? '+' : ''} + ${point.amount} + 'P'">+450P</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>